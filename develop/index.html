<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Developing with SMF | SoupedModFramework</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="SoupedModFramework documentation and website">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.8f27f883.css" as="style"><link rel="preload" href="/assets/js/app.0a85b516.js" as="script"><link rel="preload" href="/assets/js/3.d403c29e.js" as="script"><link rel="preload" href="/assets/js/2.6c2ac7ba.js" as="script"><link rel="preload" href="/assets/js/12.ced8766f.js" as="script"><link rel="prefetch" href="/assets/js/10.77610cdd.js"><link rel="prefetch" href="/assets/js/11.8f3282ae.js"><link rel="prefetch" href="/assets/js/13.a0a634b1.js"><link rel="prefetch" href="/assets/js/14.b1ffbd0f.js"><link rel="prefetch" href="/assets/js/4.19ae1615.js"><link rel="prefetch" href="/assets/js/5.38cbe85f.js"><link rel="prefetch" href="/assets/js/6.6bdd7de7.js"><link rel="prefetch" href="/assets/js/7.373bfd4f.js"><link rel="prefetch" href="/assets/js/8.dc3670a8.js"><link rel="prefetch" href="/assets/js/9.73279a85.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8f27f883.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">SoupedModFramework</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/develop/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Develop
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/develop/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Develop
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Developing with SMF</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/develop/#about-smf-and-how-it-works" class="sidebar-link">About SMF and how it works</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/develop/#creating-your-first-mod" class="sidebar-link">Creating your first mod</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/develop/#getting-started-meta-json" class="sidebar-link">Getting started (+ meta.json)</a></li><li class="sidebar-sub-header"><a href="/develop/#scripting-part-1" class="sidebar-link">Scripting part 1</a></li><li class="sidebar-sub-header"><a href="/develop/#analyzing-the-dump" class="sidebar-link">Analyzing the dump</a></li><li class="sidebar-sub-header"><a href="/develop/#scripting-part-2" class="sidebar-link">Scripting part 2</a></li><li class="sidebar-sub-header"><a href="/develop/#sharing-your-mod" class="sidebar-link">Sharing your mod</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="developing-with-smf"><a href="#developing-with-smf" class="header-anchor">#</a> Developing with SMF</h1> <h2 id="about-smf-and-how-it-works"><a href="#about-smf-and-how-it-works" class="header-anchor">#</a> About SMF and how it works</h2> <p>Part of SMF's goal is to expose an API to create mods for Bloons TD Battles 2 (which I will refer to as 'BTDB2'). Unlike Bloons TD6 (BTD6), BTDB2 is not made with Unity. Since Unity uses C#, modding tools like MelonLoader can be used on BTD6 to create mods. MelonLoader is powerful and gives you a library you can link your own C# code against to create mods. BTDB2, on the other hand, was not created with Unity, but instead a proprietary engine created by Ninja Kiwi. This engine is believed to be a heavily modified version of the BTD5/BTDB1 engines. This engine is written in C++ and not C#, so unfortunately we cannot decompile the game to make mods. (Even if we could decompile the game, it wouldn't produce anything meaningful to mod creators, since function &amp; type names would have been lost in the process) This does not mean making mods is impossible! Looking back on BTD5's modding scene, there is something called a 'jet' file. These 'jet' files hold the contents for the game's assets. In BTDB2, we have 'jet' files inside of the game's files, but no way to edit them. Unlike BTD5, we cannot just extract the jet files with 7zip, (Technically we actually can, but there's no reason to as you'll find out) However, we <em>can</em> modify their contents inside of the game's memory. This is done in the form of 'patchers', which you will learn all about in this guide.</p> <h2 id="creating-your-first-mod"><a href="#creating-your-first-mod" class="header-anchor">#</a> Creating your first mod</h2> <p>SMF mods are very simple, they are just uncompressed tar/zip files with a 'meta.json' file inside. While developing a mod, you will not be required to package it into the tar/zip archive to test it.</p> <h3 id="getting-started-meta-json"><a href="#getting-started-meta-json" class="header-anchor">#</a> Getting started (+ meta.json)</h3> <p>To get started, create a new folder inside of the 'mods' folder. (If there is no 'mods' folder, simply create one) You can name this folder anything you want. Inside of the folder, create a new 'meta.json' file. It is important that the meta.json file has the information SMF needs. Take a look at the meta.json example file below:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;authors&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;DisabledMallis&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;B2C&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;NeverGlow&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;This is an example mod that does very cool things!&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;modid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;example&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Example Mod&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;exampleScript.js&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>So, what do these fields mean?</p> <ul><li><code>authors</code> - A list of who created the mod</li> <li><code>description</code> - A description of what the mod does</li> <li><code>modid</code> - The mod's ID, should not contain: Capital letters, Spaces, Numbers</li> <li><code>name</code> - The name of the mod</li> <li><code>scripts</code> - A list of every script file this mod needs to load</li> <li><code>version</code> - The version of the mod</li></ul> <p>It is important that the file includes a <code>name</code>, <code>modid</code>, <code>version</code> and <code>scripts</code> field. You shouldn't leave out the other fields, but it wont be very problematic if you do.</p> <h3 id="scripting-part-1"><a href="#scripting-part-1" class="header-anchor">#</a> Scripting part 1</h3> <p>Now that we have our meta.json created, lets create a script for our mod. Inside of the meta.json, we specified that the mod has a script called <code>exampleScript.js</code>. So, inside of the mod folder we create a new <code>exampleScript.js</code> file. Scripts are created using <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript" target="_blank" rel="noopener noreferrer">JavaScript<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (JS), which is fairly easy to learn. Since the JS code is not running in a browser, but inside of the game itself, most browser front-end APIs are missing (such as <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window" target="_blank" rel="noopener noreferrer"><code>window._</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document" target="_blank" rel="noopener noreferrer"><code>document._</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) but we don't need those to create mods anyway.</p> <p>Inside of our script, we may want to create something called a 'patcher'. A patcher just modifies the game's assets when theyre loaded. You can register a patcher with the <code>souped.registerPatcher</code> function. However, there is an easier version of the function called <code>souped.registerJsonPatcher</code> which makes modifying the game's json a little bit easier.</p> <p>To register a patcher, simply add this into your mod's JS file:</p> <div class="language-js extra-class"><pre class="language-js"><code>souped<span class="token punctuation">.</span><span class="token function">registerJsonPatcher</span><span class="token punctuation">(</span><span class="token string">&quot;simulation&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tack_shooter.tower_blueprint&quot;</span><span class="token punctuation">,</span> myPatcher<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Now you may be wondering what <code>myPatcher</code> is. It's important to create the actual patcher itself <em>before</em> that line in order for it to be registered. Your code may look like the following:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">myPatcher</span><span class="token punctuation">(</span><span class="token parameter">bundleName<span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">successful</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> data <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

souped<span class="token punctuation">.</span><span class="token function">registerJsonPatcher</span><span class="token punctuation">(</span><span class="token string">&quot;simulation&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tack_shooter.tower_blueprint&quot;</span><span class="token punctuation">,</span> myPatcher<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The next missing piece of this puzzle is the <code>&quot;tack_shooter.tower_blueprint&quot;</code> string. This parameter of the function is a 'selector' for which files this patcher should patch. If you were to write <code>&quot;.tower_blueprint&quot;</code>, that would mean every single file with <code>&quot;.tower_blueprint&quot;</code> in its file name would be patched by this patcher, effectively giving you a way to modify every single tower in the game with a single patcher.
The <code>&quot;simulation&quot;</code> is the name of the bundle (.jet file) containing the <code>&quot;tack_shooter.tower_blueprint&quot;</code> file. If you want to search <em>every</em> bundle, you can put <code>&quot;*&quot;</code> instead.</p> <p>But what is a &quot;tower_blueprint&quot; file?</p> <h3 id="analyzing-the-dump"><a href="#analyzing-the-dump" class="header-anchor">#</a> Analyzing the dump</h3> <p>When you launch BTDB2 with SMF, it will create a 'dump' folder. Inside of this folder holds all of the assets that your game has loaded while SMF is loaded. The folders inside are named in the format of <code>&lt;name&gt;_&lt;hash&gt;.jet</code> so they may be confusing to read. Either way, the one with the name &quot;simulation&quot; contains the files for in-match assets. We can find the &quot;tack_shooter.tower_blueprint&quot; file inside of the &quot;game_data/game_project/assets/towers/tack_shooter/data&quot; folder. You can open this file in <a href="https://code.visualstudio.com/" target="_blank" rel="noopener noreferrer">VS Code<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. This is the recommended code editor to use for making SMF mods. When you open the file, click the 'Plain Text' button in the bottom right. This will give you the option to change the file type inside of VS Code, change it to &quot;JSON&quot;. This will allow you to format the document by pressing <code>ctrl</code>+<code>shift</code>+<code>p</code>, and then typing &quot;Format Document&quot;. This will make the JSON a lot easier to read.</p> <h3 id="scripting-part-2"><a href="#scripting-part-2" class="header-anchor">#</a> Scripting part 2</h3> <p>Now that we have a &quot;tower_blueprint&quot; file we want to edit, we can modify it in our script. Lets say we want to change the 'range' variable of the JSON</p> <p>tack_shooter.tower_blueprint example:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    ...
    <span class="token property">&quot;variables&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;range&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;variable&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Float&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token number">23.0</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        ...
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Our script:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">myPatcher</span><span class="token punctuation">(</span><span class="token parameter">bundleName<span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//Get the variables</span>
    <span class="token keyword">var</span> tackVars <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">&quot;variables&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">//Loop through the variables to find the 'range' variable</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> tackVars<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//Get the current variable</span>
        <span class="token keyword">var</span> currentVar <span class="token operator">=</span> tackVars<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">//Check if it is the range variable</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>currentVar<span class="token punctuation">[</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">&quot;range&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//Get the variable object</span>
            <span class="token keyword">var</span> rangeVar <span class="token operator">=</span> currentVar<span class="token punctuation">[</span><span class="token string">&quot;variable&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token comment">//Set its value</span>
            rangeVar<span class="token punctuation">[</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">99</span><span class="token punctuation">;</span>
            <span class="token comment">//Store the variable back into the current var</span>
            currentVar<span class="token punctuation">[</span><span class="token string">&quot;variable&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> rangeVar<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//Store the current var back into tackVars</span>
        tackVars<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> currentVar<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//Store tackVars back into the data</span>
    data<span class="token punctuation">[</span><span class="token string">&quot;variables&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> tackVars<span class="token punctuation">;</span>

    <span class="token comment">//Return that it was successful, as well as the modified data</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">successful</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> data <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

souped<span class="token punctuation">.</span><span class="token function">registerJsonPatcher</span><span class="token punctuation">(</span><span class="token string">&quot;simulation&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tack_shooter.tower_blueprint&quot;</span><span class="token punctuation">,</span> myPatcher<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="sharing-your-mod"><a href="#sharing-your-mod" class="header-anchor">#</a> Sharing your mod</h3> <p>Now that you have created a mod, you may want to share it with others. You will need <a href="https://www.7-zip.org/" target="_blank" rel="noopener noreferrer">7-zip<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to do this part of the tutorial. The best way to do this is to distribute them as &quot;.smf&quot; files. To create a .smf file for your mod, select all of the files inside of your mod folder and then right-click → 7-zip → Add to archive... Select 'tar' for the &quot;Archive format&quot;. Rename the file to replace '.tar' with '.smf' (this tells SMF that the file <em>is</em> a tar file containing a valid 'meta.json' file). You now have a shareable mod file!</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0a85b516.js" defer></script><script src="/assets/js/3.d403c29e.js" defer></script><script src="/assets/js/2.6c2ac7ba.js" defer></script><script src="/assets/js/12.ced8766f.js" defer></script>
  </body>
</html>
